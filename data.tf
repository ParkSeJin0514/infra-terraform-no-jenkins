# ============================================================================
# data.tf - 데이터 소스
# ============================================================================
# 외부 데이터를 조회하기 위한 Data Source 정의
# ============================================================================

# ============================================================================
# AWS 계정 정보 조회
# ============================================================================
# 현재 AWS 계정 ID를 조회합니다.
# IAM 정책에서 리소스 ARN 구성 시 사용
#
# 사용법: data.aws_caller_identity.current.account_id
# ============================================================================
data "aws_caller_identity" "current" {}

# ============================================================================
# Ubuntu AMI 조회
# ============================================================================
# 최신 Ubuntu 24.04 AMI를 동적으로 조회합니다.
# AMI ID를 하드코딩하면 리전마다, 시간이 지나면 변경해야 하지만,
# Data Source를 사용하면 항상 최신 AMI를 자동으로 찾습니다.
#
# 사용법: data.aws_ami.ubuntu.id
# ============================================================================
data "aws_ami" "ubuntu" {
  most_recent = true       # 조건에 맞는 AMI 중 가장 최신 선택
  owners      = ["amazon"] # Amazon 공식 AMI만

  # 동적 필터 - terraform.tfvars에서 정의
  # name: ubuntu/images/hvm-ssd-gp3/ubuntu-noble-24.04-amd64-server-*
  # root-device-type: ebs
  # virtualization-type: hvm
  # architecture: x86_64
  dynamic "filter" {
    for_each = var.ubuntu_ami_filters
    content {
      name   = filter.value.name
      values = filter.value.values
    }
  }
}